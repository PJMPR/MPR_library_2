package library.dao.repositories.impl;

import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;

import library.dao.mappers.IMapper;
import library.dao.uow.IUnitOfWork;
import library.domain.Book;

public class BookRepository extends RepositoryBase<Book>  {
	
protected BookRepository(Connection connection, IMapper<Book> mapper,
			IUnitOfWork uow) throws SQLException {
		super(connection, mapper, uow);
	}

	
	public Book get(int id){
		Book book = null;
				
		try {
			selectById.setInt(1, id);
			ResultSet rs = selectById.executeQuery();
			while(rs.next()){
				book=new Book();
				book.setTitle(rs.getString("title"));
				book.setLanguage(rs.getString("language"));
				book.setAvailable(rs.getString("surname").contentEquals("Y"));
				book.setId(rs.getInt("id"));
			}
		} catch (SQLException e) {
			e.printStackTrace();
		}		
				
		return book;
	}
	

@Override
protected String createTableSql() {
	return "CREATE TABLE book("
			+ "id bigint GENERATED BY DEFAULT AS IDENTITY,"
			+ "title VARCHAR(100),"
			+ "publisher VARCHAR(20),"
			+ "releaseDate VARCHAR(20),"
			+ "additionDate VARCHAR(20),"
			+ "language VARCHAR(20),"
			+ "section VARCHAR(20),"
			+ "isAvailable VARCHAR(1),"
			+ "PRIMARY KEY(id)"
			+ ")";
}

@Override
protected String getTableName() {
	return "book";
}

@Override
protected String getInsertSql() {
	return "INSERT INTO book (title, publisher, releaseDate, language, section, isAvailable)"
			+ "VALUES (?,?,?,?,?,?)";
}

@Override
protected String getUpdateSql() {
	return "INSERT INTO book (title, publisher, releaseDate, language, section, isAvailable)"
			+ "= (?,?,?,?,?,?) WHERE id=?";
}

@Override
protected void setInsert(Book book) throws SQLException {
	insert.setString(1, book.getTitle());
	insert.setString(2, "publisher");
	insert.setDate(3, book.getReleaseDate());
	insert.setString(4, book.getLanguage());
	insert.setString(5, "section");
	insert.setString(6, (book.isAvailable() ? "Y" : "N"));
	
}

@Override
protected void setUpdate(Book book) throws SQLException {
	update.setString(1, book.getTitle());
	update.setString(2, "publisher");
	update.setDate(3, book.getReleaseDate());
	update.setString(4, book.getLanguage());
	update.setString(5, "section");
	update.setString(6, (book.isAvailable() ? "Y" : "N"));
	update.setInt(7, book.getId());
}
	

}
